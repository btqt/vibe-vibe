
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index</title>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; line-height: 1.6; max-width: 800px; margin: 0 auto; padding: 20px; color: #333; }
        pre { background: #f4f4f4; padding: 15px; border-radius: 5px; overflow-x: auto; }
        code { background: #f4f4f4; padding: 2px 5px; border-radius: 3px; font-family: monospace; }
        a { color: #007bff; text-decoration: none; }
        a:hover { text-decoration: underline; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        img { max-width: 100%; height: auto; }
    </style>
</head>
<body>
<hr />
<h2>title: "ChÆ°Æ¡ng 5: 3 tráº¡ng thÃ¡i váº­n hÃ nh cá»§a code vÃ  nguyÃªn lÃ½ build"</h2>
<h1>ChÆ°Æ¡ng 5: 3 tráº¡ng thÃ¡i váº­n hÃ nh cá»§a code vÃ  nguyÃªn lÃ½ build</h1>
<h2>Lá»i tá»±a</h2>
<p>Báº¡n nghe thá»±c táº­p sinh cÃ´ng ty bÃªn cáº¡nh ká»ƒ má»™t cÃ¢u chuyá»‡n. Cáº­u ta ngÃ y Ä‘áº§u Ä‘i lÃ m, leader báº£o chuáº©n bá»‹ má»™t báº£n demo cháº¡y local. Cáº­u ta hÄƒm há»Ÿ cháº¡y <code>pnpm dev</code>, má»i thá»© bÃ¬nh thÆ°á»ng.</p>
<p>NhÆ°ng khi leader há»i: "Báº£n demo local nÃ y tÃ´i cÃ³ xem Ä‘Æ°á»£c khÃ´ng?", cáº­u thá»±c táº­p sinh má»›i phÃ¡t hiá»‡n â€”â€” <strong>trÃªn mÃ¡y leader khÃ´ng cÃ³ cáº¥u hÃ¬nh database cá»§a cáº­u, mÃ  cháº¿ Ä‘á»™ Dev cÅ©ng khÃ´ng thÃ­ch há»£p Ä‘á»ƒ demo</strong>.</p>
<p>Leader báº£o: "PhÃ¡t triá»ƒn local dÃ¹ng cháº¿ Ä‘á»™ Dev, tiá»‡n cho cáº­u debug. NhÆ°ng cÃ¡i Ä‘á»ƒ cho ngÆ°á»i dÃ¹ng xem thÃ¬ pháº£i <code>pnpm build</code> ra báº£n production, rá»“i deploy lÃªn server."</p>
<p>Cáº­u thá»±c táº­p sinh má»›i vá»¡ láº½, hÃ³a ra code cÃ³ <strong>mÃ´i trÆ°á»ng cháº¡y khÃ¡c nhau</strong>: Local dev dÃ¹ng Dev, cho ngÆ°á»i dÃ¹ng xem lÃ  báº£n Build xong deploy lÃªn server. Báº¡n nghe chuyá»‡n nÃ y xong, cáº£m tháº¥y chÆ°Æ¡ng nÃ y pháº£i há»c cho ká»¹.</p>
<h3>3 tráº¡ng thÃ¡i</h3>
<p>Äá»ƒ trÃ¡nh bá»‹ nháº§m láº«n khi Ä‘i sÃ¢u vÃ o phÃ¡t triá»ƒn, sÆ° phá»¥ Ä‘áº·c biá»‡t phá»• cáº­p cho báº¡n vá» <strong>3 tráº¡ng thÃ¡i vÃ²ng Ä‘á»i</strong> cá»§a code.</p>
<p>Äáº§u tiÃªn lÃ  <strong>Dev (Cháº¿ Ä‘á»™ phÃ¡t triá»ƒn)</strong>, chÃ­nh lÃ  <code>pnpm dev</code> báº¡n hay dÃ¹ng. NÃ³ giá»‘ng nhÆ° <strong>lÃ m nhÃ¡p</strong>. á» cháº¿ Ä‘á»™ nÃ y, khi báº¡n sá»­a code vÃ  lÆ°u, trÃ¬nh duyá»‡t <strong>khÃ´ng cáº§n</strong> refresh toÃ n trang, mÃ  chá»‰ thay tháº¿ má»™t máº£nh component nhá» vá»«a sá»­a. CÃ³ nghÄ©a lÃ  náº¿u báº¡n Ä‘ang Ä‘iá»n má»™t cÃ¡i form dÃ i dáº±ng dáº·c, sá»­a láº¡i style xong, ná»™i dung Ä‘Ã£ Ä‘iá»n trong form <strong>khÃ´ng bá»‹ máº¥t</strong>. NhÆ°ng cÃ¡i giÃ¡ pháº£i tráº£ lÃ  tá»‘c Ä‘á»™ cháº¡y khÃ¡ cháº­m, vÃ  chá»©a má»™t Ä‘á»‘ng thÃ´ng tin debug dÃ¹ng Ä‘á»ƒ bÃ¡o lá»—i.</p>
<p>Thá»© hai lÃ  <strong>Build (Cháº¿ Ä‘á»™ xÃ¢y dá»±ng)</strong>, khi báº¡n chuáº©n bá»‹ online, cáº§n cháº¡y <code>pnpm build</code>. QuÃ¡ trÃ¬nh nÃ y giá»‘ng nhÆ° <strong>Ä‘em báº£n nhÃ¡p Ä‘i dÃ n trang in thÃ nh sÃ¡ch</strong>. NÃ³ sáº½ nÃ©n, tá»‘i Æ°u, phiÃªn dá»‹ch táº¥t cáº£ code TypeScript, React báº¡n viáº¿t, cuá»‘i cÃ¹ng sinh ra má»™t thÆ° má»¥c <code>.next</code> (hoáº·c <code>dist</code>) trong dá»± Ã¡n. Code trong nÃ y dung lÆ°á»£ng cá»±c nhá», cháº¡y cá»±c nhanh, lÃ  báº£n chÃ­nh thá»©c chuyÃªn dÃ nh cho ngÆ°á»i dÃ¹ng.</p>
<p>Cuá»‘i cÃ¹ng lÃ  <strong>Production (Cháº¿ Ä‘á»™ sáº£n xuáº¥t)</strong>, cháº¡y <code>pnpm start</code> (hoáº·c <code>next start</code>). ÄÃ¢y lÃ  <strong>mÃ´ phá»ng mÃ´i trÆ°á»ng online chÃ­nh thá»©c</strong> ngay trÃªn local, dÃ¹ng Ä‘á»ƒ cháº¡y cÃ¡i "báº£n chÃ­nh thá»©c" vá»«a sinh ra tá»« bÆ°á»›c <code>build</code>. ThÃ´ng thÆ°á»ng trÆ°á»›c khi online, báº¡n sáº½ dÃ¹ng cháº¿ Ä‘á»™ nÃ y Ä‘á»ƒ kiá»ƒm tra láº§n cuá»‘i xem cÃ³ Bug khÃ´ng.</p>
<h3>LÆ°u lÃ  cÃ³ hiá»‡u lá»±c</h3>
<p>CÃ³ thá»ƒ báº¡n tÃ² mÃ²: Táº¡i sao á»Ÿ cháº¿ Ä‘á»™ Dev cá»© lÆ°u file lÃ  trÃ¬nh duyá»‡t tá»± refresh? CÃ¡i nÃ y gá»i lÃ  <strong>Hot Reload (Táº£i láº¡i nÃ³ng)</strong>.</p>
<p>CÃ´ng cá»¥ phÃ¡t triá»ƒn sáº½ nghe ngÃ³ng sá»± thay Ä‘á»•i cá»§a file á»Ÿ háº­u Ä‘Ã i. Má»™t khi phÃ¡t hiá»‡n cÃ³ sá»­a Ä‘á»•i, nÃ³ sáº½ tá»± Ä‘á»™ng refresh trÃ¬nh duyá»‡t hoáº·c chá»‰ cáº­p nháº­t pháº§n thay Ä‘á»•i. Viá»‡c nÃ y giÃºp báº¡n khÃ´ng cáº§n má»—i láº§n Ä‘á»u pháº£i F5 thá»§ cÃ´ng, hiá»‡u suáº¥t phÃ¡t triá»ƒn tÄƒng vá»t.</p>
<p>CÃ²n á»Ÿ cháº¿ Ä‘á»™ Build hoáº·c Production, code Ä‘Ã£ Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i tá»‘i Æ°u, khÃ´ng cÃ³ cÆ¡ cháº¿ nghe ngÃ³ng nÃ y, nÃªn sá»­a xong cáº§n build láº¡i. Hiá»ƒu Ä‘Æ°á»£c sá»± khÃ¡c biá»‡t nÃ y, báº¡n sáº½ biáº¿t táº¡i sao thá»‰nh thoáº£ng sá»­a code mÃ  khÃ´ng tháº¥y cÃ³ tÃ¡c dá»¥ng â€”â€” cÃ³ thá»ƒ lÃ  Ä‘ang cháº¡y sai cháº¿ Ä‘á»™.</p>
<h3>package.json</h3>
<p>LÃºc nÃ y, cÃ³ thá»ƒ báº¡n sáº½ tháº¯c máº¯c: <strong>Táº¡i sao gÃµ <code>pnpm dev</code> lÃ  cháº¡y Ä‘Æ°á»£c dá»± Ã¡n?</strong> SÆ° phá»¥ báº£o báº¡n má»Ÿ file <strong><code>package.json</code></strong> á»Ÿ thÆ° má»¥c gá»‘c ra. Ã”ng báº£o, Ä‘Ã¢y lÃ  <strong>file cáº¥u hÃ¬nh cá»‘t lÃµi</strong> cá»§a dá»± Ã¡n Node.js, quáº£n lÃ½ metadata, script vÃ  dependency cá»§a dá»± Ã¡n.</p>
<ul>
<li>
<p><strong>Quáº£n lÃ½ Script (Scripts)</strong>: Trong trÆ°á»ng <code>scripts</code>, Ä‘á»‹nh nghÄ©a cÃ¡c lá»‡nh cháº¡y thÆ°á»ng dÃ¹ng cá»§a dá»± Ã¡n. Khi báº¡n gÃµ <code>pnpm dev</code> trong terminal, trÃ¬nh quáº£n lÃ½ gÃ³i sáº½ tra báº£ng, tháº¥y nÃ³ tÆ°Æ¡ng á»©ng vá»›i lá»‡nh <code>next dev</code> vÃ  thá»±c thi lá»‡nh Ä‘Ã³. ÄÃ¢y lÃ  lÃ½ do táº¡i sao cÃ¡c lá»‡nh táº§ng dÆ°á»›i phá»©c táº¡p cÃ³ thá»ƒ Ä‘Æ°á»£c Ä‘Æ¡n giáº£n hÃ³a thÃ nh <code>dev</code> hay <code>build</code> ngáº¯n gá»n. <strong>SÆ° phá»¥ tiá»‡n má»“m nháº¯c luÃ´n, Ä‘Ã¢y cÅ©ng lÃ  chá»— Ä‘á»ƒ tÃ¹y chá»‰nh "sá»‘ phÃ²ng".</strong> CÃ²n nhá»› cÃ¡i lá»—i chiáº¿m dá»¥ng cá»•ng phiá»n phá»©c á»Ÿ chÆ°Æ¡ng 1 khÃ´ng? Báº¡n hoÃ n toÃ n cÃ³ thá»ƒ sá»­a lá»‡nh á»Ÿ Ä‘Ã¢y thÃ nh <code>next dev -p 4000</code>. NhÆ° váº­y, láº§n sau cháº¡y <code>pnpm dev</code>, á»©ng dá»¥ng sáº½ khá»Ÿi Ä‘á»™ng luÃ´n á»Ÿ cá»•ng 4000, trÃ¡nh xa cá»•ng 3000 Ä‘Ã´ng Ä‘Ãºc.</p>
</li>
<li>
<p><strong>Quáº£n lÃ½ Dependency (Dependencies)</strong>: Danh sÃ¡ch <code>dependencies</code> ghi láº¡i rÃµ rÃ ng cÃ¡c thÆ° viá»‡n bÃªn thá»© 3 (nhÆ° React, Next.js, Drizzle) vÃ  phiÃªn báº£n cá»¥ thá»ƒ mÃ  dá»± Ã¡n báº¯t buá»™c pháº£i cÃ i Ä‘á»ƒ cháº¡y Ä‘Æ°á»£c. Viá»‡c nÃ y Ä‘áº£m báº£o ngÆ°á»i khÃ¡c (hoáº·c server) khi láº¥y code vá», cÃ³ thá»ƒ thÃ´ng qua <code>pnpm install</code> Ä‘á»ƒ cÃ i Ä‘áº·t cÃ¡c thÆ° viá»‡n y há»‡t, khÃ´i phá»¥c hoÃ n háº£o mÃ´i trÆ°á»ng phÃ¡t triá»ƒn cá»§a báº¡n.</p>
</li>
</ul>
<h3>Sáº£n pháº©m Build (Build Artifcats)</h3>
<p>Build xong, báº¡n Ä‘á»‹nh tÃ¬m file <code>index.html</code> trong thÆ° má»¥c Ä‘á»ƒ click Ä‘Ãºp má»Ÿ ra, giá»‘ng nhÆ° há»“i chÆ°Æ¡ng 1. SÆ° phá»¥ báº£o sáº£n pháº©m build náº±m trong thÆ° má»¥c <code>.next</code> (hoáº·c <code>dist</code>), nhÆ°ng báº¡n lá»¥c tung thÆ° má»¥c <code>.next</code> lÃªn cÅ©ng chá»‰ tháº¥y má»™t Ä‘á»‘ng file <code>.js</code> vÃ  <code>.json</code> láº±ng nháº±ng nhÆ° "ma tráº­n". SÆ° phá»¥ báº£o, <strong>Next.js Fullstack Framework dÃ¹ng trong hÆ°á»›ng dáº«n nÃ y, báº£n cháº¥t lÃ  má»™t "chÆ°Æ¡ng trÃ¬nh" cháº¡y trÃªn Node.js, chá»© khÃ´ng pháº£i "file" Ä‘Æ¡n giáº£n</strong>. NÃ³ cáº§n káº¿t ná»‘i database, xá»­ lÃ½ API request, render trang web tá»« phÃ­a server, máº¥y cÃ¡i nÃ y Ä‘á»u khÃ´ng thá»ƒ tÃ¡ch rá»i sá»± há»— trá»£ cá»§a <strong>mÃ´i trÆ°á»ng server</strong>.</p>
<p>Táº¥t nhiÃªn, cÃ³ má»™t sá»‘ ngá»¯ cáº£nh báº¡n cÃ³ thá»ƒ phÃ¡t triá»ƒn <strong>dá»± Ã¡n tÄ©nh thuáº§n tÃºy</strong> (vÃ­ dá»¥ dÃ¹ng Vite + Vue/React), dá»± Ã¡n kiá»ƒu nÃ y Ä‘Ã³ng gÃ³i xong Ä‘Ãºng lÃ  sáº½ sinh ra má»™t file <code>index.html</code> trong thÆ° má»¥c <code>dist</code>. NhÆ°ng Ä‘á»ƒ dáº«n dáº¯t báº¡n Ä‘i háº¿t quy trÃ¬nh Fullstack trá»n váº¹n gá»“m database, auth..., chÃºng ta chá»n Next.js. CÃ³ Ä‘iá»u pháº£i nhá»›, ká»ƒ cáº£ lÃ  file tÄ©nh thuáº§n tÃºy do Vite Ä‘Ã³ng gÃ³i, thÆ°á»ng cÅ©ng khÃ´ng thá»ƒ click Ä‘Ãºp má»Ÿ trá»±c tiáº¿p. VÃ¬ á»©ng dá»¥ng hiá»‡n Ä‘áº¡i sá»­ dá»¥ng <strong>Ä‘Æ°á»ng dáº«n tuyá»‡t Ä‘á»‘i</strong> (nhÆ° <code>/assets/app.js</code>) Ä‘á»ƒ dáº«n tÃ i nguyÃªn, mÃ  má»Ÿ click Ä‘Ãºp thÃ¬ láº¡i dÃ¹ng <strong>giao thá»©c file</strong> (<code>file:///</code>), dáº«n Ä‘áº¿n viá»‡c trÃ¬nh duyá»‡t khÃ´ng tÃ¬m tháº¥y tÃ i nguyÃªn.</p>
<p>VÃ¬ tháº¿, xin hÃ£y nhá»› ká»¹: <strong>Äá»«ng bao giá» click Ä‘Ãºp má»Ÿ trá»±c tiáº¿p file code sau khi build, hÃ£y luÃ´n truy cáº­p á»©ng dá»¥ng thÃ´ng qua Web Server (nhÆ° <code>pnpm start</code> cá»§a Next.js hoáº·c <code>pnpm preview</code> cá»§a dá»± Ã¡n Vite).</strong></p>
<h3>Cache (Bá»™ nhá»› Ä‘á»‡m)</h3>
<p>NhÆ° Ä‘Ã£ nÃ³i, cháº¿ Ä‘á»™ Dev cÃ³ Hot Reload, sá»­a code lÆ°u cÃ¡i lÃ  trÃ¬nh duyá»‡t tá»± cáº­p nháº­t, thÆ°á»ng khÃ´ng bá»‹ váº¥n Ä‘á» cache.</p>
<p>NhÆ°ng á»Ÿ <strong>cháº¿ Ä‘á»™ Production</strong> (cháº¡y <code>pnpm start</code>) hoáº·c <strong>khi truy cáº­p trang web Ä‘Ã£ deploy</strong>, báº¡n cÃ³ thá»ƒ gáº·p chuyá»‡n láº¡ do <strong>trÃ¬nh duyá»‡t cache</strong>. VÃ­ dá»¥ báº¡n Ä‘á»•i nÃºt báº¥m tá»« xanh sang Ä‘á», <code>pnpm build</code> láº¡i rá»“i truy cáº­p, nÃºt báº¥m váº«n trÆ¡ ra mÃ u xanh. Báº¡n suy sá»¥p, tÆ°á»Ÿng mÃ¬nh lá»t vÃ o vÅ© trá»¥ song song.</p>
<p>HÃ³a ra, Ä‘á»ƒ táº£i nhanh hÆ¡n, trÃ¬nh duyá»‡t Ä‘Ã£ lÆ°u cÃ¡c file CSS/JS cÅ© vÃ o local. Báº¡n há»c Ä‘Æ°á»£c 3 tuyá»‡t chiÃªu: Má»™t lÃ  <strong>báº¯t buá»™c refresh</strong> (giá»¯ <code>Ctrl</code> + <code>Shift</code> + <code>R</code>); Hai lÃ  má»Ÿ cháº¿ Ä‘á»™ áº©n danh; Ba lÃ  má»Ÿ F12 Developer Tools, trong tab Network tÃ­ch vÃ o <strong>"Disable cache"</strong>.</p>
<p>Náº¿u báº¯t buá»™c refresh mÃ  váº«n khÃ´ng Ä‘Æ°á»£c, cÃ³ thá»ƒ lÃ  váº¥n Ä‘á» <strong>cache build</strong>, cáº§n xÃ³a thÆ° má»¥c <code>.next</code> Ä‘i rá»“i <code>pnpm run build</code> láº¡i.</p>
<p>CÃ²n má»™t cÃ¡i há»‘ hay bá»‹ bá» quÃªn: Sá»­a file <code>.env</code> xong báº¯t buá»™c pháº£i khá»Ÿi Ä‘á»™ng láº¡i service (Ctrl+C rá»“i npm run dev), biáº¿n mÃ´i trÆ°á»ng má»›i cÃ³ hiá»‡u lá»±c. <strong>ã€Xem chi tiáº¿t ChÆ°Æ¡ng 6ã€‘</strong> sáº½ giáº£i thÃ­ch ká»¹ táº¡i sao biáº¿n mÃ´i trÆ°á»ng Ä‘Æ°á»£c load khi khá»Ÿi Ä‘á»™ng tiáº¿n trÃ¬nh, nÃªn lÃºc cháº¡y mÃ  sá»­a file thÃ¬ nÃ³ khÃ´ng tá»± cáº­p nháº­t.</p>
<hr />
<h2>Äiá»u hÆ°á»›ng chÆ°Æ¡ng</h2>
<pre><code>- 5.1 RÃ  soÃ¡t báº«y Cache (./01-cache-traps.md) ğŸ”´
- 5.2 Ba cháº¿ Ä‘á»™ váº­n hÃ nh (./02-runtime-modes.md) ğŸŸ¢
- 5.3 HÆ°á»›ng dáº«n thá»±c dá»¥ng package.json (./03-package-json-guide.md) ğŸŸ¢
- 5.4 Sáº£n pháº©m Build vÃ  Web Server (./04-build-artifacts-server.md) ğŸŸ¢
</code></pre>
</body>
</html>
