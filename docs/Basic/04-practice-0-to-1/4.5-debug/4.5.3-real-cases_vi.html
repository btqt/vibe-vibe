
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4.5.3 Real Cases</title>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; line-height: 1.6; max-width: 800px; margin: 0 auto; padding: 20px; color: #333; }
        pre { background: #f4f4f4; padding: 15px; border-radius: 5px; overflow-x: auto; }
        code { background: #f4f4f4; padding: 2px 5px; border-radius: 3px; font-family: monospace; }
        a { color: #007bff; text-decoration: none; }
        a:hover { text-decoration: underline; }
        table { border-collapse: collapse; width: 100%; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        img { max-width: 100%; height: auto; }
    </style>
</head>
<body>
<hr />
<p>title: "4.5.3 Phân tích trường hợp thực tế"
order: 4</p>
<hr />
<p><img alt="04-practice-0-to-1_4.5-debug_4.5.3-real-cases.png" src="../../../public/images/Basic/04-practice-0-to-1_4.5-debug_4.5.3-real-cases.png" /></p>
<h1>4.5.3 Phân tích trường hợp thực tế</h1>
<p>Phần này giới thiệu 6 lỗi điển hình trong quá trình phát triển danh sách việc cần làm, bao gồm thông tin báo lỗi đầy đủ, quá trình chẩn đoán và hội thoại sửa chữa.</p>
<h2>Tra cứu nhanh trường hợp</h2>
<table>
<thead>
<tr>
<th>Trường hợp</th>
<th>Loại lỗi</th>
<th>Từ khóa thông báo lỗi</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#trường-hợp-1-danh-sách-nhiệm-vụ-là-undefined">Trường hợp 1</a></td>
<td>TypeError</td>
<td><code>Cannot read properties of undefined</code></td>
</tr>
<tr>
<td><a href="#trường-hợp-2-hàm-chưa-được-định-nghĩa">Trường hợp 2</a></td>
<td>ReferenceError</td>
<td><code>is not defined</code></td>
</tr>
<tr>
<td><a href="#trường-hợp-3-localstorage-phân-tích-thất-bại">Trường hợp 3</a></td>
<td>SyntaxError</td>
<td><code>Unexpected token</code></td>
</tr>
<tr>
<td><a href="#trường-hợp-4-nhấp-nút-không-phản-ứng">Trường hợp 4</a></td>
<td>Lỗi logic</td>
<td>Không báo lỗi</td>
</tr>
<tr>
<td><a href="#trường-hợp-5-kiểu-dáng-đột-ngột-biến-mất">Trường hợp 5</a></td>
<td>Lỗi CSS</td>
<td>Không báo lỗi</td>
</tr>
<tr>
<td><a href="#trường-hợp-6-trạng-thái-hoàn-thành-không-tài-nào-lưu-được">Trường hợp 6</a></td>
<td>Lỗi logic</td>
<td>Không báo lỗi</td>
</tr>
</tbody>
</table>
<h2>Trường hợp 1: Danh sách nhiệm vụ là undefined</h2>
<h3>Hiện tượng lỗi</h3>
<p>Sau khi nhấp nút thêm, nhiệm vụ không xuất hiện. Console hiển thị báo lỗi màu đỏ.</p>
<h3>Báo lỗi trong Console</h3>
<pre><code>Uncaught TypeError: Cannot read properties of undefined (reading 'push')
    at addTask (index.html:45:15)
    at HTMLButtonElement.&lt;anonymous&gt; (index.html:52:5)
</code></pre>
<h3>Định vị vấn đề</h3>
<p>Lỗi này có nghĩa là: Mã đang cố gắng gọi phương thức <code>push</code> trên <code>undefined</code>. <code>push</code> là phương thức của mảng, chứng tỏ mã kỳ vọng đây là một mảng, nhưng thực tế lại là <code>undefined</code>.</p>
<p>Xem mã dòng 45:</p>
<pre><code class="language-javascript">tasks.push({ text: taskText, completed: false });
</code></pre>
<p>Vấn đề nằm ở biến <code>tasks</code> - nó chưa được khởi tạo đúng cách.</p>
<h3>Hội thoại chẩn đoán</h3>
<p><strong>Prompt bạn gửi</strong>:</p>
<pre><code>Mã nguồn danh sách việc cần làm của tôi báo lỗi:

【Hiện tượng】Sau khi nhấp nút thêm, nhiệm vụ không xuất hiện
【Báo lỗi】Uncaught TypeError: Cannot read properties of undefined (reading 'push')
    at addTask (index.html:45:15)

【Mã nguồn】
function addTask() {
    const input = document.querySelector('.task-input');
    const taskText = input.value.trim();
    if (taskText) {
        tasks.push({ text: taskText, completed: false });
        renderTasks();
        input.value = '';
    }
}

Hãy giúp tôi phân tích nguyên nhân.
</code></pre>
<p><strong>Phân tích của AI</strong>:</p>
<blockquote>
<p>Lỗi này biểu thị biến <code>tasks</code> là <code>undefined</code> khi gọi <code>push</code>. Nguyên nhân là vì <code>tasks</code> chưa được khởi tạo thành mảng trước khi sử dụng. Bạn cần khai báo <code>let tasks = [];</code> ở đầu mã nguồn.</p>
</blockquote>
<h3>Hội thoại sửa chữa</h3>
<p><strong>Prompt bạn gửi</strong>:</p>
<pre><code>Hãy giúp tôi sửa chữa. Cần:
1. Khởi tạo biến tasks ở đầu mã nguồn
2. Đưa cho tôi mã hoàn chỉnh sau khi sửa
</code></pre>
<p><strong>Mã sửa chữa AI đưa ra</strong> (Phần chính):</p>
<pre><code class="language-javascript">// Thêm dòng này ở đầu mã
let tasks = [];  // Khởi tạo mảng nhiệm vụ

function addTask() {
    const input = document.querySelector('.task-input');
    const taskText = input.value.trim();
    if (taskText) {
        tasks.push({ text: taskText, completed: false });
        renderTasks();
        input.value = '';
    }
}
</code></pre>
<h3>Phương pháp xác thực</h3>
<ol>
<li>Thay thế mã xong làm mới trang</li>
<li>Nhập nhiệm vụ vào ô nhập liệu, nhấp thêm</li>
<li>Xác nhận nhiệm vụ xuất hiện trong danh sách</li>
<li>Xác nhận console không có báo lỗi đỏ</li>
</ol>
<h2>Trường hợp 2: Hàm chưa được định nghĩa</h2>
<h3>Hiện tượng lỗi</h3>
<p>Sau khi tải trang, console ngay lập tức hiển thị báo lỗi.</p>
<h3>Báo lỗi trong Console</h3>
<pre><code>Uncaught ReferenceError: addTask is not defined
    at HTMLButtonElement.onclick (index.html:15:42)
</code></pre>
<h3>Định vị vấn đề</h3>
<p><code>ReferenceError: xxx is not defined</code> biểu thị mã đã sử dụng một biến hoặc hàm không tồn tại.</p>
<p>Nguyên nhân thường gặp:
- Tên hàm sai chính tả
- Định nghĩa hàm nằm sau khi gọi (vấn đề thứ tự mã)
- Hàm viết sai vị trí</p>
<h3>Hội thoại chẩn đoán</h3>
<p><strong>Prompt bạn gửi</strong>:</p>
<pre><code>Vừa tải trang là báo lỗi: ReferenceError: addTask is not defined

Trong HTML của tôi có nút bấm thế này:
&lt;button onclick=&quot;addTask()&quot;&gt;Thêm&lt;/button&gt;

Trong JavaScript của tôi có hàm này:
function addtask() {
    // ... nội dung hàm
}

Hãy giúp tôi phân tích nguyên nhân.
</code></pre>
<p><strong>Phân tích của AI</strong>:</p>
<blockquote>
<p>Vấn đề nằm ở chỗ chữ hoa chữ thường của tên hàm không thống nhất. Trong HTML gọi là <code>addTask()</code> (T viết hoa), nhưng trong JavaScript định nghĩa là <code>addtask()</code> (t viết thường). JavaScript phân biệt chữ hoa chữ thường, hai cái này được xem là hàm khác nhau.</p>
</blockquote>
<h3>Phương pháp sửa chữa</h3>
<p>Sửa tên hàm trong JavaScript thành <code>addTask</code> (thống nhất với HTML):</p>
<pre><code class="language-javascript">// Trước khi sửa
function addtask() {

// Sau khi sửa
function addTask() {
</code></pre>
<h3>Phương pháp xác thực</h3>
<ol>
<li>Thay thế mã xong làm mới trang</li>
<li>Xác nhận console không còn <code>ReferenceError</code></li>
<li>Nhấp nút thêm, xác nhận chức năng bình thường</li>
</ol>
<h2>Trường hợp 3: localStorage phân tích thất bại</h2>
<h3>Hiện tượng lỗi</h3>
<p>Báo lỗi khi tải trang, nhiệm vụ lưu trước đó không hiển thị được.</p>
<h3>Báo lỗi trong Console</h3>
<pre><code>Uncaught SyntaxError: Unexpected token 'u', &quot;undefined&quot; is not valid JSON
    at JSON.parse (&lt;anonymous&gt;)
    at loadTasks (index.html:68:24)
</code></pre>
<h3>Định vị vấn đề</h3>
<p>Lỗi này xảy ra khi <code>JSON.parse()</code>. Thông tin lỗi <code>"undefined" is not valid JSON</code> biểu thị đang cố gắng phân tích chuỗi <code>"undefined"</code>, chứ không phải JSON hợp lệ.</p>
<p>Nguyên nhân thường gặp:
- Khi localStorage không có dữ liệu, <code>getItem</code> trả về <code>null</code>
- Mã chưa xử lý tình huống <code>null</code>, truyền trực tiếp cho <code>JSON.parse</code></p>
<h3>Hội thoại chẩn đoán</h3>
<p><strong>Prompt bạn gửi</strong>:</p>
<pre><code>Đọc localStorage báo lỗi: SyntaxError: Unexpected token 'u', &quot;undefined&quot; is not valid JSON

Mã đọc dữ liệu của tôi:
function loadTasks() {
    const saved = localStorage.getItem('todoList');
    tasks = JSON.parse(saved);
    renderTasks();
}

Hãy giúp tôi phân tích.
</code></pre>
<p><strong>Phân tích của AI</strong>:</p>
<blockquote>
<p>Khi trong localStorage không có key 'todoList', <code>getItem</code> trả về <code>null</code>. <code>JSON.parse(null)</code> sẽ cố gắng phân tích, nhưng trong một số trường hợp có thể gây ra vấn đề. Phổ biến hơn là, nếu trước đó đã lưu nhầm chuỗi <code>undefined</code>, sẽ xuất hiện lỗi này. Bạn cần kiểm tra dữ liệu có tồn tại không trước khi phân tích.</p>
</blockquote>
<h3>Hội thoại sửa chữa</h3>
<p><strong>Prompt bạn gửi</strong>:</p>
<pre><code>Hãy giúp tôi sửa hàm loadTasks, đảm bảo:
1. Nếu localStorage không có dữ liệu, dùng mảng rỗng
2. Nếu định dạng dữ liệu không đúng, cũng dùng mảng rỗng
3. Đưa cho tôi mã sửa chữa hoàn chỉnh
</code></pre>
<p><strong>Mã sửa chữa AI đưa ra</strong>:</p>
<pre><code class="language-javascript">function loadTasks() {
    const saved = localStorage.getItem('todoList');

    // Kiểm tra có dữ liệu đã lưu không
    if (saved &amp;&amp; saved !== 'undefined') {
        try {
            tasks = JSON.parse(saved);
        } catch (e) {
            // Nếu phân tích thất bại, dùng mảng rỗng
            console.log('Định dạng dữ liệu lỗi, đã đặt lại');
            tasks = [];
        }
    } else {
        // Không có dữ liệu đã lưu, dùng mảng rỗng
        tasks = [];
    }

    renderTasks();
}
</code></pre>
<h3>Phương pháp xác thực</h3>
<ol>
<li>Thay thế mã xong làm mới trang</li>
<li>Xác nhận console không có báo lỗi</li>
<li>Thêm vài nhiệm vụ, làm mới trang, xác nhận nhiệm vụ vẫn còn</li>
</ol>
<h2>Trường hợp 4: Nhấp nút không phản ứng</h2>
<h3>Hiện tượng lỗi</h3>
<p>Nhấp nút thêm, không có bất kỳ phản ứng nào. Console cũng không có báo lỗi.</p>
<h3>Định vị vấn đề</h3>
<p>Đây là "Lỗi logic" điển hình - ngữ pháp mã đúng, nhưng hành vi không như mong đợi.</p>
<p>Nguyên nhân có thể:
- Bộ lắng nghe sự kiện chưa gắn đúng
- Bộ chọn (selector) nút bị viết sai
- Vấn đề thứ tự thực thi mã (Thực thi trước khi DOM tải xong)</p>
<h3>Hội thoại chẩn đoán</h3>
<p><strong>Prompt bạn gửi</strong>:</p>
<pre><code>Nút thêm của tôi nhấp không phản ứng, console cũng không báo lỗi.

Nút trong HTML:
&lt;button class=&quot;add-btn&quot;&gt;Thêm&lt;/button&gt;

Ràng buộc trong JavaScript:
const addBtn = document.querySelector('.add-button');
addBtn.addEventListener('click', addTask);

Hãy giúp tôi kiểm tra vấn đề.
</code></pre>
<p><strong>Phân tích của AI</strong>:</p>
<blockquote>
<p>Vấn đề nằm ở chỗ bộ chọn CSS không khớp. Class của nút trong HTML là <code>add-btn</code>, nhưng trong JavaScript lại tìm <code>.add-button</code>. Do không tìm thấy phần tử, <code>addBtn</code> là <code>null</code>, gọi <code>addEventListener</code> tiếp theo thất bại (tuy đôi khi không báo lỗi).</p>
</blockquote>
<h3>Phương pháp sửa chữa</h3>
<p>Thống nhất tên bộ chọn:</p>
<pre><code class="language-javascript">// Trước khi sửa (Bộ chọn không khớp)
const addBtn = document.querySelector('.add-button');

// Sau khi sửa (Khớp với HTML)
const addBtn = document.querySelector('.add-btn');
</code></pre>
<h3>Phương pháp xác thực</h3>
<ol>
<li>Thay thế mã xong làm mới trang</li>
<li>Nhấp nút thêm, xác nhận chức năng bình thường</li>
</ol>
<h2>Trường hợp 5: Kiểu dáng đột ngột biến mất</h2>
<h3>Hiện tượng lỗi</h3>
<p>Sau khi để AI thêm chức năng mới, kiểu dáng toàn trang biến mất hết, trở thành văn bản thuần.</p>
<h3>Định vị vấn đề</h3>
<p>Việc này thường xảy ra khi AI sửa mã, vô tình xóa hoặc phá hỏng phần CSS.</p>
<p>Nguyên nhân thường gặp:
- AI chỉ trả về phần JavaScript, khi bạn thay thế đã ghi đè lên toàn bộ tệp
- Mã CSS xuất hiện lỗi cú pháp
- Thẻ <code>&lt;style&gt;</code> bị xóa nhầm</p>
<h3>Hội thoại chẩn đoán</h3>
<p><strong>Prompt bạn gửi</strong>:</p>
<pre><code>Sau khi tôi bảo bạn thêm chức năng xóa, kiểu dáng trang biến mất hết.
Bây giờ trang chỉ hiển thị văn bản thuần, không có bất kỳ kiểu dáng nào.

Hãy giúp tôi kiểm tra:
1. Kiểm tra thẻ &lt;style&gt; có còn nguyên vẹn không
2. Kiểm tra cú pháp CSS có lỗi không
3. Nếu kiểu dáng bị mất, hãy giúp tôi khôi phục

Đây là tệp HTML hoàn chỉnh hiện tại của tôi:
[Dán mã hoàn chỉnh]
</code></pre>
<p><strong>Phân tích của AI</strong>:</p>
<blockquote>
<p>Tôi phát hiện vấn đề rồi. Trong lần sửa đổi trước, thẻ <code>&lt;style&gt;</code> bị xóa nhầm. Tôi sẽ giúp bạn khôi phục mã kiểu dáng hoàn chỉnh.</p>
</blockquote>
<h3>Phương pháp sửa chữa</h3>
<p>Để AI tạo lại mã chứa đầy đủ kiểu dáng, hoặc khôi phục phần CSS từ phiên bản trước.</p>
<h3>Biện pháp phòng ngừa</h3>
<ul>
<li>Mỗi lần để AI sửa mã nhớ sao lưu phiên bản hiện tại trước</li>
<li>Nói rõ với AI: "Chỉ sửa phần JavaScript, đừng động vào HTML và CSS"</li>
<li>Nhận được mã từ AI, kiểm tra cấu trúc có đầy đủ không rồi mới thay thế</li>
</ul>
<h2>Trường hợp 6: Trạng thái hoàn thành không tài nào lưu được</h2>
<h3>Hiện tượng lỗi</h3>
<p>Sau khi đánh dấu nhiệm vụ là "Đã hoàn thành", làm mới trang, nhiệm vụ phục hồi về trạng thái "Chưa hoàn thành".</p>
<h3>Định vị vấn đề</h3>
<p>Đây là lỗi logic về lưu trữ bền vững - Thay đổi trạng thái hoàn thành không kích hoạt thao tác lưu.</p>
<h3>Hội thoại chẩn đoán</h3>
<p><strong>Prompt bạn gửi</strong>:</p>
<pre><code>Trạng thái hoàn thành của nhiệm vụ không lưu được.

【Các bước tái hiện】
1. Thêm một nhiệm vụ
2. Nhấp nút hoàn thành, nhiệm vụ hiển thị là đã hoàn thành
3. Làm mới trang
4. Nhiệm vụ phục hồi về trạng thái chưa hoàn thành

【Hiện tượng】
Thao tác thêm và xóa đều lưu được, nhưng trạng thái hoàn thành thì không

【Mã nguồn liên quan】
function toggleComplete(index) {
    tasks[index].completed = !tasks[index].completed;
    renderTasks();
}

function saveTasks() {
    localStorage.setItem('todoList', JSON.stringify(tasks));
}

Hãy giúp tôi phân tích nguyên nhân.
</code></pre>
<p><strong>Phân tích của AI</strong>:</p>
<blockquote>
<p>Hàm <code>toggleComplete</code> đã sửa đổi trạng thái nhiệm vụ và hiển thị lại, nhưng không gọi <code>saveTasks()</code> lưu vào localStorage. Chức năng thêm và xóa lưu được có thể là do trong hàm của chúng đã gọi <code>saveTasks()</code>, còn <code>toggleComplete</code> bị sót.</p>
</blockquote>
<h3>Hội thoại sửa chữa</h3>
<p><strong>Prompt bạn gửi</strong>:</p>
<pre><code>Hãy giúp tôi sửa chữa, thêm thao tác lưu vào trong hàm toggleComplete.
</code></pre>
<p><strong>Mã sửa chữa AI đưa ra</strong>:</p>
<pre><code class="language-javascript">function toggleComplete(index) {
    tasks[index].completed = !tasks[index].completed;
    saveTasks();  // Thêm dòng này: lưu vào localStorage
    renderTasks();
}
</code></pre>
<h3>Phương pháp xác thực</h3>
<ol>
<li>Thay thế mã xong làm mới trang</li>
<li>Thêm một nhiệm vụ</li>
<li>Nhấp nút hoàn thành</li>
<li>Làm mới trang</li>
<li>Xác nhận nhiệm vụ vẫn hiển thị là đã hoàn thành</li>
</ol>
<h2>Điểm chính phần này</h2>
<ul>
<li>Mỗi trường hợp đều tuân theo quy trình "Hiện tượng → Báo lỗi → Định vị → Sửa chữa → Xác thực"</li>
<li>TypeError thường là biến chưa định nghĩa hoặc sai kiểu</li>
<li>ReferenceError thường là lỗi chính tả hoặc vấn đề phạm vi (scope)</li>
<li>SyntaxError thường gặp ở JSON.parse khi dữ liệu rỗng hoặc sai định dạng</li>
<li>Lỗi logic không có thông báo lỗi, cần đối chiếu "hành vi kỳ vọng" và "hành vi thực tế"</li>
<li>Lỗi kiểu dáng cần kiểm tra mã CSS có đầy đủ không</li>
</ul>
<p>Nắm vững các trường hợp này, bạn sẽ có thể đối phó với phần lớn vấn đề trong quá trình phát triển danh sách việc cần làm.</p>
<p>→ <a href="./4.5.4-debug-mindset_vi.html">4.5.4 Tâm pháp Debug tổng kết</a></p>
</body>
</html>
